<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>BreweryDB Test</title>
    <script
  src="https://code.jquery.com/jquery-3.2.1.min.js"
  integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4="
  crossorigin="anonymous"></script>
    <script src="https://www.gstatic.com/firebasejs/4.2.0/firebase.js"></script>
    <script src="https://cdn.jsdelivr.net/momentjs/2.12.0/moment.min.js"></script>
    <link rel="stylesheet" type="text/css" href="./assets/css/style.css">
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
</head>

<body>
  <div class="container">
    
    <div class="jumbotron text-center">
    <h1>Mmm Beer</h1>
    <p>Pour one out for the homies.</p>
    </div>
    
    <div class="panel panel-danger">
      <div class="panel-heading">Brewery List</div>
      <div class="panel-body">
        <table class="table table-hover" id="breweryTable">
          <thead>
            <tr>
              <th>Logo</th>
              <th>Brewery Name</th>
              <th>Phone Number</th>
              <th>Address</th>
            </tr>
          </thead>
          <tbody>
          </tbody>
        </table>
      </div>
    </div>
    <div class="panel panel-primary">
      <div class="panel-heading">Search for Breweries</div>
      <div class="panel-body">
        <form>
          <div class="input-group">
            <span class="input-group-addon">Zip Code</span>
            <input id="trainName" type="text" class="form-control" placeholder="90210">
          </div>
          <br />
          <div class="input-group">  
            <span class="input-group-addon">City</span>
            <input id="trainDest" type="text" class="form-control" placeholder="Springfield">
          </div>
          <br />
          <div class="input-group">  
            <span class="input-group-addon">State</span>
            <input id="trainFTT" type="text" class="form-control" placeholder="California">
          </div>
          <br />
          <button type="submit" id="brewerySubmit" class="btn btn-primary">Search Breweries</button>
        </form>
      </div>
    </div>
  </div>
<script type="text/javascript">

$.getJSON('http://www.whateverorigin.org/get?url=' + encodeURIComponent('https://api.brewerydb.com/v2/locations?key=cead0935bcae01ba063baf6bfb4b5988&postalCode=92101') + '&callback=?', function(response){
  console.log(response.contents);

  for (var i = 0; i < 10; i++) {

    var breweryLong = response.contents.data[i].longitude;
    var breweryLat = response.contents.data[i].latitude;
    if (breweryLong === undefined) {
      breweryLong = ''
    }
    if (breweryLat === undefined) {
      breweryLat = ''
    }

    // {
    //   lat: response.contents.data[i].latitude,
    //   lng: response.contents.data[i].longitude
    // }

    // JSON.stringify(something)

    var breweryLatLong = "{lat:" + breweryLat + "," + "lng:" + breweryLong + " }"
    var breweryHours = response.contents.data[i].hoursOfOperation;
    var breweryIcons = '<a data-toggle="tooltip" data-placement="top" title="' + breweryHours + '" href="' + response.contents.data[i].website +'">' + '<img width="auto" height="auto" src="' + response.contents.data[i].brewery.images.icon + '"' + ' /></a>';
    var breweryNames = '<a data-toggle="tooltip" data-placement="top" title="' + breweryHours + '" href="' + response.contents.data[i].website +'">' + response.contents.data[i].brewery.name + '</a>';
    //var breweryWebsite = '<a href="' + response.contents.data[i].website +'">' + response.contents.data[i].brewery.name + '</a>';
    var breweryPhones = response.contents.data[i].phone;
    var breweryAddresses = response.contents.data[i].streetAddress + ", " + response.contents.data[i].locality + ", " + response.contents.data[i].region + " " + response.contents.data[i].postalCode;

    if (breweryHours === undefined) {
      breweryHours = ''
    }

    // Local temporary object holding train data
    var newBrewery = {
      name:  breweryNames,
      location: breweryLatLong,
      hours: breweryHours,
      icon: breweryIcons,
      phone: breweryPhones,
      address: breweryAddresses
    }
    console.log(newBrewery);
    // Uploads train data to the database
    database.ref().push(newBrewery);

    $("#breweryTable > tbody").append("<tr><td>" + breweryIcons + "</td>" + "<td>" + breweryNames + "</td>" + "<td>" + breweryPhones + "</td>" + "<td>" + breweryAddresses + "</td>" + "<td class='hide'>" + breweryLong + "</td>" + "<td class='hide'>" + breweryLat + "</td>" +"</tr>");
  }

});



  // Initialize Firebase
  var config = {
    apiKey: "AIzaSyDQfYrUrTZn_iCRKV4e3SuRte9T6YpN16o",
    authDomain: "fullstack-7d2ee.firebaseapp.com",
    databaseURL: "https://fullstack-7d2ee.firebaseio.com",
    projectId: "fullstack-7d2ee",
    storageBucket: "fullstack-7d2ee.appspot.com",
    messagingSenderId: "1057228698441"
  };
  firebase.initializeApp(config);

  // Assign the reference to the database to a variable named 'database'
var database = firebase.database();

  // Ends the on-click.
  // return false;


</script>
</script>
</body>
</html>
